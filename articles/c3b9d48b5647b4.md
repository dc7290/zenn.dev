---
title: "Vitestã®å®Ÿè¡Œæ™‚é–“ã‚’8å€é«˜é€ŸåŒ–ï¼šåŒä¸€ç’°å¢ƒã§ã®å®Ÿè¡Œã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vitest", "test", "react", "axe"]
published: false
publication_name: "microcms"
---

# ã¯ã˜ã‚ã«

Vitest ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§ã¯ã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«åˆ†é›¢ã•ã‚ŒãŸç’°å¢ƒã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œã—ã¾ã™ã€‚
ã“ã®è¨­å®šã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã‚„å‰¯ä½œç”¨ã«ä¾å­˜ã—ãŸå®Ÿè£…ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ãŸã‚ã«æœ‰åŠ¹ã§ã™ã€‚

ã—ã‹ã—ã€ã“ã®è¨­å®šã¯å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒã®èµ·å‹•ã‚„ç ´æ£„ã‚’è¡Œã†ãŸã‚ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ãŒé•·ããªã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ã€ç’°å¢ƒã®åˆ†é›¢è¨­å®šã‚’ã‚„ã‚ã¦åŒä¸€ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€å®Ÿè¡Œé€Ÿåº¦ã‚’å‘ä¸Šã•ã›ãŸæ–¹æ³•ã¨ãã‚Œã«ä¼´ã£ã¦ç™ºç”Ÿã—ãŸå•é¡Œã®ä¿®æ­£æ–¹æ³•ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚

:::message
Vitest ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ã§ã¯èª¬æ˜ã‚’è¡Œã„ã¾ã›ã‚“ã€‚
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://vitest.dev/guide/
:::

# èƒŒæ™¯

å¼Šç¤¾ã¯ microCMS ã¨ã„ã†ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ CMS ã‚’é–‹ç™ºã—ã¦ãŠã‚Šã€ãã®ç®¡ç†ç”»é¢ã¯ React ã§é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚
å¤§ã¾ã‹ãªæ§‹æˆã¨ã—ã¦ã¯ã€Vite ã‚’ä½¿ç”¨ã—ãŸ SPA ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ testing-library/react ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ user-event ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆï¼‰ã‚„é–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆãŒä¸»ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ä»Šå›ã®æ”¹å–„ã‚’è¡Œã†å‰ã¯ã€ç´„ 1600 ã®ãƒ†ã‚¹ãƒˆã«å¯¾ã—ã¦ 10 åˆ†ã»ã©ã‹ã‹ã£ã¦ã„ã¾ã—ãŸã€‚ãã®å¾Œã€[ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°](https://vitest.dev/guide/improving-performance.html#sharding)ã«ã‚ˆã‚‹ä¸¦åˆ—åŒ–ã§ 5 åˆ†å‰²ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œãªã£ã¦ãŠã‚Šã¾ã—ãŸãŒãã‚Œã§ã‚‚ 4 åˆ†ã»ã©ã‹ã‹ã£ã¦ã„ã¾ã—ãŸã€‚
ã¾ãŸã€GitHub Actions ã®æ–™é‡‘ä½“ç³»ã¨ã—ã¦ã€ã‚¸ãƒ§ãƒ–ãªã©ã‚’ä¸¦åˆ—åŒ–ã—ãŸéš›ã«ãã‚Œãã‚Œã®å®Ÿè¡Œæ™‚é–“ãŒåŠ ç®—ã•ã‚Œã‚‹ãŸã‚ã€ä¸¦åˆ—åŒ–ã™ã‚Œã°ãã‚Œã§ä½•ã®å•é¡Œã‚‚ãªã—ã¨ã„ã†ã‚ã‘ã«ã‚‚ã„ãã¾ã›ã‚“ã€‚

ãã—ã¦ä»Šå›ã®æ”¹å–„å¾Œã«ã¯ã€ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹ä¸¦åˆ—åŒ–ãªã—ã§ **70 ç§’**ã»ã©ã«çŸ­ç¸®ã•ã‚Œã€**ç´„ 8 å€ã®é«˜é€ŸåŒ–**ã«æˆåŠŸã—ã¾ã—ãŸã€‚

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®åŠ¹æœ

![](https://storage.googleapis.com/zenn-user-upload/0cfd01eb3ece-20250421.png)
![](https://storage.googleapis.com/zenn-user-upload/ea38c901fc3f-20250421.png)

| é …ç›®                  | æ”¹å–„å‰   | æ”¹å–„å¾Œ    | æ”¹å–„ç‡     |
| --------------------- | -------- | --------- | ---------- |
| ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“        | 575 ç§’   | 70 ç§’     | ç´„ 88%å‰Šæ¸› |
| CI ã‚¸ãƒ§ãƒ–ã®ç·å®Ÿè¡Œæ™‚é–“ | ç´„ 15 åˆ† | ç´„ 1.5 åˆ† | ç´„ 90%å‰Šæ¸› |

:::message
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã¨åŒæ™‚ã«ä¸è¦ãªãƒ†ã‚¹ãƒˆã®æ•´ç†ã‚‚è¡Œãªã£ãŸãŸã‚ãƒ†ã‚¹ãƒˆã®æ•°ã«è‹¥å¹²ã®æ¸›å°‘ãŒã‚ã‚Šã¾ã™ã€‚
:::

# ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚ªãƒ•ã«ã™ã‚‹

Vitest ã§ç’°å¢ƒã®åˆ†é›¢ã‚’ã—ãªã„æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã¯[isolate](https://vitest.dev/config/#isolate)ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ false ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚
ã—ã‹ã—ã€å…ˆè¿°ã—ãŸé€šã‚Š Vitest ã¯ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã€åŒä¸€ç’°å¢ƒã ã¨ãƒ†ã‚¹ãƒˆåŒå£«ãŒå½±éŸ¿ã—ã¦å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ˆã‚Šé«˜ããªã‚Šã¾ã™ã€‚
ã“ã†ã—ãŸãƒ†ã‚¹ãƒˆåŒå£«ã®å½±éŸ¿ã‚’é¿ã‘ã‚‹ãŸã‚ã€é€æ¬¡å®Ÿè¡Œã‹ã¤åŒä¸€ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸã€‚

## è¨­å®šæ–¹æ³•

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```bash
vitest run --pool threads --poolOptions.threads.singleThread
```

ã¾ãŸã€vitest.config ã®ãƒ•ã‚¡ã‚¤ãƒ«å´ã«è¨­å®šã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯ãŠã™ã™ã‚ã—ã¾ã›ã‚“ã€‚
ã“ã®ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚ªãƒ•ã«ã™ã‚‹æ–¹æ³•ã¯ watch ãƒ¢ãƒ¼ãƒ‰ã§å•é¡ŒãŒã‚ã‚Šã€æ™®æ®µã®é–‹ç™ºæ™‚ã«ã¯é©ã•ãªã„æ–¹æ³•ã ã‹ã‚‰ã§ã™ã€‚
ãã®ãŸã‚ CI ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ã«é©ç”¨ã™ã‚‹ãŸã‚ CLI ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

:::message
æ™®æ®µã®é–‹ç™ºæ™‚ã¯ `vitest --standalone` ã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
ã“ã®è¨­å®šã¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã›ãšã« Vitest ã‚’èµ·å‹•ã§ãã¦ã€ãƒ†ã‚¹ãƒˆã®å¤‰æ›´æ™‚ã®ã¿å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
https://vitest.dev/guide/cli.html#standalone
:::

# ç™ºç”Ÿã—ãŸå•é¡Œ

ãŠãã‚‰ãä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»Šã¾ã§æˆåŠŸã—ã¦ã„ãŸãƒ†ã‚¹ãƒˆã®ã„ãã¤ã‹ã¯å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
microCMS ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã§ã¯ä»¥ä¸‹ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

1. testing-library/react ã® cleanup ãŒè¡Œã‚ã‚Œãšå‰ã®ãƒ†ã‚¹ãƒˆã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœãŒæ¬¡ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã™ã‚‹
2. i18next ã®è¨€èªè¨­å®šã®å¤‰æ›´ãŒæ¬¡ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã™ã‚‹
3. React.useId ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®çµæœãŒãƒ†ã‚¹ãƒˆå®Ÿè¡Œé †åºã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹
4. axe-core ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹

## testing-library/react ã® cleanup ãŒè¡Œã‚ã‚Œãšå‰ã®ãƒ†ã‚¹ãƒˆã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœãŒæ¬¡ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã™ã‚‹

ã“ã® Issue ãŒé–¢ä¿‚ã—ã¦ã„ãã†ã§ã—ãŸã€‚
https://github.com/vitest-dev/vitest/issues/1430

æœ¬æ¥ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« globals ã‚’ true ã«ã—ã¦ã„ã‚Œã°ã€testing-library/react ãŒè‡ªå‹•çš„ã« cleanup ã‚’è¡Œã£ã¦ãã‚Œã‚‹ã¯ãšãªã®ã§ã™ãŒã€ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã¨ cleanup ãŒè¡Œã‚ã‚Œãªã„ã‚ˆã†ã§ã—ãŸã€‚

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ afterEach ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

```ts:setup.ts
import { cleanup } from '@testing-library/react';
import { afterEach } from 'vitest';

afterEach(cleanup);
```

## i18next ã®è¨€èªè¨­å®šã®å¤‰æ›´ãŒæ¬¡ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã™ã‚‹

microCMS ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è‹±èªã¨æ—¥æœ¬èªã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚

```tsx
import { render } from "@testing-library/react";
import { describe, expect, test } from "vitest";

import i18n from "@/i18n";

import { Range } from "..";

describe("Range", () => {
  test.each(["ja", "en"])("Snap Shot", (lang) => {
    i18n.changeLanguage(lang);
    const { container } = render(<Range />);
    expect(container).toMatchSnapshot();
  });
});
```

ãƒ†ã‚¹ãƒˆã”ã¨ã«`i18n.changeLanguage(lang);`ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®ãƒ†ã‚¹ãƒˆå¾Œã¯è¨€èªè¨­å®šãŒè‹±èªã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
ã—ã‹ã—ã€ã“ã®æ¬¡ã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆã§æ—¥æœ¬èªã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã‚‚ã®ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨å¤±æ•—ã—ã¾ã™ã€‚

ã“ã‚ŒãŒåŸå› ã§è½ã¡ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã«`i18n.changeLanguage('ja')`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚

## `React.useId` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®çµæœãŒãƒ†ã‚¹ãƒˆå®Ÿè¡Œé †åºã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹

`useId` ã¯[ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ä¸€æ„ãª ID ã‚’ç”Ÿæˆã™ã‚‹](https://github.com/facebook/react/blob/main/packages/react-server/src/ReactFlightHooks.js#L121)ãŸã‚ã€åŒä¸€ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œé †åºã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã® HTML è¦ç´ ã® id å±æ€§ãŒå¤‰ã‚ã£ã¦ã—ã¾ã„ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®çµæœãŒå¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®æ–¹æ³•ã¨ã—ã¦ã€`useId` ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦æ¯å›åŒã˜ ID ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```ts:setup.ts
import { vi } from 'vitest';

vi.mock(import('react'), async (importOriginal) => {
  const actual = await importOriginal();
  return {
    ...actual,
    useId: () => 'r:id',
  };
});
```

microCMS ã§ã¯ RadixUI ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€RadixUI å†…éƒ¨ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹`@radix-ui/react-id`ã«ã¤ã„ã¦ã‚‚ãƒ¢ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€React.useId ã¨åŒã˜ã‚ˆã†ã«ã¯ãƒ¢ãƒƒã‚¯ãŒã§ãã¾ã›ã‚“ã€‚
ã“ã‚Œã¯ Vite ã®ç‰¹å¾´ã® 1 ã¤ã§ã‚ã‚‹[ä¾å­˜é–¢ä¿‚ã‚’äº‹å‰ãƒãƒ³ãƒ‰ãƒ«](https://vite.dev/guide/features.html#npm-dependency-resolving-and-pre-bundling)ã™ã‚‹ã“ã¨ã®å½±éŸ¿ã§ã€å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã§ã™ã€‚

ä»¥ä¸‹ã®è¨˜äº‹ã«ã¦è§£æ±ºç­–ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://zenn.dev/rizzzse/articles/56a33a77baf512

RadixUI ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```ts:vitest.config.ts
import { defineConfig } from 'vitest/config';
export default defineConfig({
  test: {
    server: {
      deps: {
        inline: ['radix-ui', /@radix-ui\/.*/],
      },
    },
  },
});
```

```ts:setup.ts
import { vi } from 'vitest';

vi.mock('@radix-ui/react-id', () => {
  return {
    useId: () => 'r:id',
  };
});
```

ã“ã‚Œã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`useId` ã¯æ¯å›åŒã˜ ID ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®çµæœãŒãƒ†ã‚¹ãƒˆå®Ÿè¡Œé †åºã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ã“ã¨ãŒãªããªã‚Šã¾ã™ã€‚

## axe-core ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹

ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®ä¸€ç’°ã¨ã—ã¦ axe-coreï¼ˆvitest-axeï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ãã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã“ã‚Œã¯ä»¥ä¸‹ã® Issue ãŒé–¢ä¿‚ã—ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚
https://github.com/dequelabs/axe-core/issues/3426

ãŸã ã—ã€ä»Šå›ã®æ–¹æ³•ã§ã¯åŒä¸€ç’°å¢ƒå†…ã§é€æ¬¡å®Ÿè¡Œã‚’ã—ã¦ãŠã‚Šä¸¦åˆ—å®Ÿè¡Œã§ã¯ãªã„ãŸã‚ã€ãªãœã“ã®å•é¡ŒãŒç”Ÿã˜ã‚‹ã®ã‹è©³ç´°ã«ã¤ã„ã¦ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
axe ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã®ã†ã¡ã€ã„ãšã‚Œã‹ã®ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã®ã¡ã€ãã‚Œä»¥é™ã®ãƒ†ã‚¹ãƒˆã§ã¯`Axe is already running`ã®ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ç¾è±¡ã§ã€[ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆ](https://github.com/dequelabs/axe-core/issues/3426#issuecomment-1553588452)ã«ã‚ã‚‹é€šã‚Šãƒ†ã‚¹ãƒˆã®å¤±æ•—å¾Œã«ã€Œå®Œäº†ã€ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œãšã€æ¬¡ã®å®Ÿè¡Œæ™‚ã«ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨èªè­˜ã•ã‚Œã¦ã—ã¾ã†ã®ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚

ä»Šå›ã® Vitest ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã§ã¯ã“ã®å•é¡Œã«å¯¾ã—ã¦ã¯æœ¬è³ªçš„æ”¹å–„ã¯ã›ãšã« CI ä¸Šã§ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã€ä»»æ„ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã¨ã—ã¾ã—ãŸã€‚

`test.runIf` ã‚’ä½¿ç”¨ã—ã¦ã€`VITEST_ENABLE_A11Y_CHECK`ã‚’ true ã«è¨­å®šã—ãŸæ™‚ã®ã¿å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```tsx
import { render } from "@testing-library/react";
import { describe, expect, test } from "vitest";
import { axe } from "vitest-axe";

import { Range } from "..";

const enableA11yCheck = process.env.VITEST_ENABLE_A11Y_CHECK === "true";

describe("Range", () => {
  test.runIf(enableA11yCheck)("a11y check", async () => {
    const { container } = render(<Range />);
    expect(await axe(container)).toHaveNoViolations();
  });
});
```

axe-core ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯æ¬¡ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
VITEST_ENABLE_A11Y_CHECK=true vitest run --testNamePattern 'a11y check'
```

# ã¾ã¨ã‚

ä»Šå›ã®æ”¹å–„ã§ã¯ã€Vitest ã®ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚„ã‚ã¦åŒä¸€ç’°å¢ƒã§é€æ¬¡å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã‚’ç´„ 8 å€é«˜é€ŸåŒ–ã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸã€‚
Vitest ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã™ã‚‹æ–¹æ³•ã¯ã€ä»–ã«ã‚‚ãƒãƒ¬ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚„ã‚ãŸã‚Šã€`test.concurrent`ã‚’ä½¿ç”¨ã—ãŸä¸¦åˆ—åŒ–ã‚„ã€`deps.optimizer.web`ã‚’ä½¿ç”¨ã—ãŸä¾å­˜é–¢ä¿‚ã®æœ€é©åŒ–ãªã©ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã®ã‚ˆã†ã«ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã“ã¨ã§åŠ‡çš„ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šå¾Œã®å±•æœ›ã¨ã—ã¦ã¯ã€ç’°å¢ƒã®åˆ†é›¢ã‚’ã‚ªãƒ•ã«ã—ãŸã¾ã¾ä¸¦åˆ—å®Ÿè¡ŒãŒã§ãã‚‹ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã§ãã‚Œã°ã¨æ€ã£ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€collect ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åé›†ã«ã‹ãªã‚Šã®å‰²åˆã®æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ãƒãƒ¬ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚„ã‚ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚

CI ãŒæ—©ã„ã“ã¨ã¯é–‹ç™ºã®ç”Ÿç”£æ€§ã«æ·±ãé–¢ã‚ã‚ŠãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€ä»Šå›ã®è¨˜äº‹ã®å†…å®¹ãŒ 1 ã¤ã§ã‚‚ãŠå½¹ã«ç«‹ã¦ã¦ã„ã‚Œã°å¹¸ã„ã§ã™ã€‚

# å‚è€ƒãƒªãƒ³ã‚¯

## Vitest é–¢é€£

- [Vitest å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vitest.dev/guide/)
- [Vitest ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã‚¬ã‚¤ãƒ‰](https://vitest.dev/guide/improving-performance.html)
- [Vitest ã®è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://vitest.dev/config/)
- [Vitest ã® Issue #1430: testing-library/react ã® cleanup å•é¡Œ](https://github.com/vitest-dev/vitest/issues/1430)

## React é–¢é€£

- [React Flight Hooks: useId ã®å®Ÿè£…](https://github.com/facebook/react/blob/main/packages/react-server/src/ReactFlightHooks.js#L121)
- [Vite ã®ä¾å­˜é–¢ä¿‚ã®äº‹å‰ãƒãƒ³ãƒ‰ãƒ«](https://vite.dev/guide/features.html#npm-dependency-resolving-and-pre-bundling)

## ãƒ†ã‚¹ãƒˆé–¢é€£

- [axe-core Issue #3426: åŒä¸€ç’°å¢ƒã§ã®è¤‡æ•°å®Ÿè¡Œå•é¡Œ](https://github.com/dequelabs/axe-core/issues/3426)
- [ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã«é–¢ã™ã‚‹è¨˜äº‹](https://zenn.dev/rizzzse/articles/56a33a77baf512)

## CI/CD é–¢é€£

- [GitHub Actions ã®æ–™é‡‘ä½“ç³»](https://docs.github.com/ja/billing/managing-billing-for-github-actions/about-billing-for-github-actions)
