---
title: "next/imageã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã«ç”»åƒã‚’æœ€é©åŒ–ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ‰"
type: "tech"
topics: ["nextjs"]
published: false
---

# ã¯ã˜ã‚ã«

2022 å¹´ 5 æœˆç¾åœ¨ã€`next/image`ã‚’`next export`ã§ä½¿ã†å ´åˆã€
ç”»åƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ã£ã¦å¤–éƒ¨ URL ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
(`next/image`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Nodejs ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ãŸç”»åƒæœ€é©åŒ– API ã®ã‚‚ã¨è¡Œã‚ã‚Œã‚‹ãŸã‚)

ã—ã‹ã—ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆã‚„ Node.js ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã›ãšã«æ§‹ç¯‰ã—ãŸã„å ´åˆã«ã“ã‚Œã¯ä¸ä¾¿ã§ã™ã€‚

ã‚ˆã£ã¦ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚

- GitHub

https://github.com/dc7290/next-export-optimize-images

- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆ

https://next-export-optimize-images.vercel.app

# ç‰¹å¾´

ä¸»ãªç‰¹å¾´ã¨ã—ã¾ã—ã¦ã€ä»¥ä¸‹ãŒã‚ã‚Šã¾ã™ã€‚

- ãƒ“ãƒ«ãƒ‰æ™‚ã«ç”»åƒã‚’æœ€é©åŒ–
- `next/image`ã®å…¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½
- æ‹¡å¼µå­ã®å¤‰æ›ãŒå¯èƒ½
- `sharp`ã‚’ä½¿ç”¨ã—é«˜é€Ÿã«å‹•ä½œ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚ŠåŒã˜æœ€é©åŒ–ã®ç¹°ã‚Šè¿”ã—ã‚’é˜²æ­¢

# ä½¿ã„æ–¹

1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
yarn add -D next-export-optimize-images
```

2. `next.config.js`ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```js:next.config.js
const withExportImages = require('next-export-optimize-images')

module.exports = withExportImages({
  // write your next.js configuration values.
})
```

3. `package.json`ã®ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```diff json:package.json
{
-  "export": "next build && next export",
+  "export": "next build && next export && next-export-optimize-images",
}
```

4. é€šå¸¸é€šã‚Š`next/image`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```jsx
import Image from 'next/image'

<Image src="/images/img.png" width={1920} height={1280} alt="" />
// Or import as follows
<Image src={require('./img.png')} alt="" />
```

# è¨­å®š

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã¯å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´å¯èƒ½ã§ã™ã€‚
ãƒ«ãƒ¼ãƒˆã«`export-images.config.js`ã‚’ä½œæˆã—ã¾ã™ã€‚

```js:export-images.config.js
/**
 * @type {import('next-export-optimize-images').Config}
 */
const config = {
  // your configuration values.
}

module.exports = config
```

è©³ç´°ã¯[ã“ã¡ã‚‰](https://next-export-optimize-images.vercel.app/docs/configuration)ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã‚’ã”è¦§ãã ã•ã„ã€‚

# ä½¿ç”¨ä¾‹

ã“ã“ã§ã¯ã„ãã¤ã‹ä½¿ç”¨ä¾‹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
ãŸã ã€`next/image`ã®ä½¿ã„æ–¹ã¨åŸºæœ¬çš„ã«åŒã˜ã§ã™ã®ã§ã€è©³ã—ãã¯[ã“ã¡ã‚‰](https://nextjs.org/docs/api-reference/next/image)ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”è¦§ãã ã•ã„ã€‚

## `placeholder`ã‚’ä½¿ç”¨ã™ã‚‹

```jsx
<Image placeholder="blur" src="/images/img.png" width={1920} height={1280} alt="" />
// Or import as follows
<Image placeholder="blur" src={require('./img.png')} alt="" />
```

## `layout`ã‚’`fill`ã«è¨­å®šã™ã‚‹

```jsx
<Image layout="fill" objectFit="cover" src="/images/img.png" width={1920} height={1280} alt="" />
// Or import as follows
<Image layout="fill" objectFit="cover" src={require('./img.png')} alt="" />
```

## ç‹¬è‡ªã®`loader`ã‚’è¨­å®šã™ã‚‹

```tsx:CMSImage.tsx
import { ImageLoaderProps, ImageProps } from 'next/image'
import { FC } from 'react'

type Props = ImageProps

const CMSLoader = ({ src, width, quality }: ImageLoaderProps) => {
  const url = new URL(normalizeSrc(src))
  const params = url.searchParams

  params.set('auto', params.get('auto') || 'format')
  params.set('fit', params.get('fit') || 'max')
  params.set('w', params.get('w') || width.toString())

  if (quality) {
    params.set('q', quality.toString())
  }

  return url.href
}

const CMSImage: FC<Props> = (props) => {
  return <Image loader={CMSLoader} {...props} />
}

export default CMSImage
```

# å†…éƒ¨æ§‹é€ 

ã“ã“ã‹ã‚‰ã¯å†…éƒ¨ã§ã©ã†ã„ã£ãŸå‡¦ç†ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãŒæ°—ã«ãªã‚‹äººå‘ã‘ã«å†…éƒ¨æ§‹é€ ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦ãªçŸ¥è­˜ã§ã¯ãªã„ã®ã§ã”å®‰å¿ƒãã ã•ã„ã€‚
